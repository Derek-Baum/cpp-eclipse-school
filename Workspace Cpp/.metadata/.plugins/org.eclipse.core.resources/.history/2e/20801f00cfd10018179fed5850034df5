/*
 * LLHuff.cpp
 *
 *  Created on: Oct 16, 2018
 *      Author: Derek Baum
 */
#include <iostream>
#include "LLHuff.hpp"
#include "LLNode.hpp"
#include "LLPQ.hpp"
#include <fstream>

using namespace std;

LLHuff::LLHuff(string f){
	file = f;
	root = NULL;
	size = 0;
	pq = new LLPQ;
	ascii = NULL;
}
LLHuff::~LLHuff(){
	delete root;
	delete pq;
	delete ascii;
}
void LLHuff::MakeHuff(){
	cout<<pq->size<<endl;
	while(pq->size != 1){
		LLNode *tmp = pq->remFirst();
		LLNode *tmp2 = pq->remFirst();
		cout<<tmp->c<<endl;
		cout<<tmp2->c<<endl;
		LLNode *parent = new LLNode ('*',"-1",tmp->frequency + tmp2->frequency);
		parent->left = tmp;
		parent->right = tmp2;
		pq->insertInOrder(parent);
	}
	root = pq->first;
}
void LLHuff::setCodes(LLNode *top){
	if(top == NULL){
		return;
	}else{
		top->left->code=top->code + "0";
		top->right->code=top->code + "1";
		setCodes(top->left);
		setCodes(top->right);
	}
}
LLNode* LLHuff::FindCode(LLNode *top, char ch){
	if(top->c == ch){
		return top;
	}
	if(top == NULL){
		return NULL;
	}
	LLNode* out = top->left;
	LLNode* out2 = top->right;
	while(out != NULL || !(out->c == ch)){
		out = FindCode(out,ch);
	}
	while(out2 != NULL || !(out2->c == ch)){
			out2 = FindCode(out2,ch);
	}
	if(out == NULL)
		return out2;
	return out;


}
void LLHuff::ReadFile(){
	ifstream infile(file.c_str(),ios::in);
	char ch;
	while(infile.get(ch)){
		pq->insertUnique(ch);
	}
	infile.close();
}
void LLHuff::compressFile(){
	ifstream infile(file.c_str(),ios::in);
	char ch;
	ofstream outfile("compressed.txt",ios::out);
	while(infile.get(ch)){
		outfile<<FindCode(root,ch)->code<<" ";
	}
	infile.close();
	outfile.close();

}
void LLHuff::ReadAscii(){
	cout << file << endl;
	ifstream infile("asciitable.txt",ios::in); // open file
	char ch;
	string asciicode;
	if (!infile.is_open()) {
	return;
	}
	infile >> asciicode;
	pq->addFirst(' ',asciicode);
	infile >> asciicode;
	while (infile>>ch) { // loop getting single characters
	cout << ch;
	infile>>asciicode; // gets entire word (code)
	cout << asciicode << endl;
	pq->addAtFirst(ch,asciicode);
	}
	cout << endl;
	infile.close();
	/////////////////////////////////////
	ifstream infile2(file.c_str(),ios::in); // open file for reading
	ofstream outfile("asciivsn.txt",ios::out);
	char k;
	string comp;
	while (infile2.get(k)) { // loop getting single characters
	cout << k;
	comp = pq->findCode(k);
	if (comp == "") {
	cout << "ERROR WITH " << k << endl;
	}
	else {
	cout << k << ":" << comp << endl;
	outfile << comp << " ";
	}
	}
	cout << endl;
	infile2.close();
	outfile.close();

}
